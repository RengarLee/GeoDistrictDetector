# GeoLocationCityDetector

ä¸€ä¸ªç”¨äºæ ¹æ®åœ°ç†åæ ‡ç‚¹åˆ¤æ–­æ‰€å±åŸå¸‚ä¿¡æ¯çš„.NETå‘½ä»¤è¡Œå·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ—ºï¸ **åæ ‡åŸå¸‚æŸ¥è¯¢**: æ ¹æ®ç»çº¬åº¦åæ ‡æŸ¥æ‰¾æ‰€å±çš„åŸå¸‚ä¿¡æ¯
- ğŸ“ **å¤šæ ¼å¼æ”¯æŒ**: æ”¯æŒCSVå’ŒJSONæ ¼å¼çš„åŸå¸‚æ•°æ®æ–‡ä»¶
- ğŸ¯ **ç²¾ç¡®ç®—æ³•**: ä½¿ç”¨Haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œæ”¯æŒå¤šè¾¹å½¢è¾¹ç•Œåˆ¤æ–­
- ğŸ’» **å‘½ä»¤è¡Œå‹å¥½**: æ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’Œäº¤äº’å¼æ¨¡å¼
- âš¡ **é«˜æ€§èƒ½**: å¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒå¤§é‡åŸå¸‚æ•°æ®

## å¿«é€Ÿå¼€å§‹

### æ„å»ºé¡¹ç›®

```bash
dotnet build
```

### è¿è¡Œé¡¹ç›®

#### 1. äº¤äº’å¼æ¨¡å¼
```bash
dotnet run
```

#### 2. å‘½ä»¤è¡Œæ¨¡å¼
```bash
dotnet run sample-cities.csv 39.9042 116.4074
```

## ä½¿ç”¨æ–¹æ³•

### æ•°æ®æ–‡ä»¶æ ¼å¼

#### CSVæ ¼å¼
```csv
çœä»½,åŸå¸‚,åŒºå¿,ç»åº¦,çº¬åº¦
åŒ—äº¬å¸‚,åŒ—äº¬å¸‚,ä¸œåŸåŒº,116.4074,39.9042
ä¸Šæµ·å¸‚,ä¸Šæµ·å¸‚,é»„æµ¦åŒº,121.4692,31.2301
```

#### JSONæ ¼å¼
```json
[
  {
    "Province": "åŒ—äº¬å¸‚",
    "City": "åŒ—äº¬å¸‚",
    "District": "ä¸œåŸåŒº",
    "CenterPoint": {
      "Latitude": 39.9042,
      "Longitude": 116.4074
    },
    "Boundary": []
  }
]
```

### åæ ‡æ ¼å¼

æ”¯æŒä»¥ä¸‹åæ ‡è¾“å…¥æ ¼å¼ï¼š
- `39.9042,116.4074`
- `39.9042, 116.4074`
- `39.9042 116.4074`
- `(39.9042, 116.4074)`

## é¡¹ç›®ç»“æ„

```
GeoLocationCityDetector/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ GeoPoint.cs          # åœ°ç†åæ ‡ç‚¹æ¨¡å‹
â”‚   â””â”€â”€ CityInfo.cs          # åŸå¸‚ä¿¡æ¯æ¨¡å‹
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IGeoLocationService.cs   # åœ°ç†ä½ç½®æœåŠ¡æ¥å£
â”‚   â””â”€â”€ GeoLocationService.cs    # åœ°ç†ä½ç½®æœåŠ¡å®ç°
â”œâ”€â”€ Utils/
â”‚   â””â”€â”€ InputValidator.cs    # è¾“å…¥éªŒè¯å·¥å…·
â”œâ”€â”€ Program.cs               # ä¸»ç¨‹åºå…¥å£
â””â”€â”€ sample-cities.csv        # ç¤ºä¾‹åŸå¸‚æ•°æ®
```

## æ ¸å¿ƒç®—æ³•

### 1. è·ç¦»è®¡ç®—
ä½¿ç”¨Haversineå…¬å¼è®¡ç®—ä¸¤ä¸ªåœ°ç†åæ ‡ç‚¹ä¹‹é—´çš„çƒé¢è·ç¦»ï¼š

```csharp
double a = Math.Sin(deltaLatRad / 2) * Math.Sin(deltaLatRad / 2) +
           Math.Cos(lat1Rad) * Math.Cos(lat2Rad) *
           Math.Sin(deltaLonRad / 2) * Math.Sin(deltaLonRad / 2);
double c = 2 * Math.Atan2(Math.Sqrt(a), Math.Sqrt(1 - a));
return earthRadius * c;
```

### 2. ç‚¹åœ¨å¤šè¾¹å½¢å†…åˆ¤æ–­
ä½¿ç”¨å°„çº¿æ³•åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢è¾¹ç•Œå†…ï¼ˆå½“æœ‰è¾¹ç•Œæ•°æ®æ—¶ï¼‰ã€‚

## ç¤ºä¾‹ç”¨æ³•

### äº¤äº’å¼æ¨¡å¼ç¤ºä¾‹

```
=== åœ°ç†ä½ç½®åŸå¸‚æ£€æµ‹å™¨ ===

è¯·é€‰æ‹©æ“ä½œï¼š
1. åŠ è½½åŸå¸‚æ•°æ®æ–‡ä»¶
2. æŸ¥è¯¢åæ ‡æ‰€å±åŸå¸‚
3. æ˜¾ç¤ºå·²åŠ è½½çš„åŸå¸‚æ•°é‡
4. é€€å‡º
è¯·è¾“å…¥é€‰é¡¹ (1-4): 1

è¯·è¾“å…¥åŸå¸‚æ•°æ®æ–‡ä»¶è·¯å¾„ (æ”¯æŒCSVå’ŒJSONæ ¼å¼): sample-cities.csv
æˆåŠŸåŠ è½½ 22 ä¸ªåŸå¸‚æ•°æ®
åŸå¸‚æ•°æ®åŠ è½½æˆåŠŸï¼

è¯·é€‰æ‹©æ“ä½œï¼š
1. åŠ è½½åŸå¸‚æ•°æ®æ–‡ä»¶
2. æŸ¥è¯¢åæ ‡æ‰€å±åŸå¸‚
3. æ˜¾ç¤ºå·²åŠ è½½çš„åŸå¸‚æ•°é‡
4. é€€å‡º
è¯·è¾“å…¥é€‰é¡¹ (1-4): 2

è¯·è¾“å…¥åæ ‡ (æ ¼å¼ï¼šçº¬åº¦,ç»åº¦ï¼Œå¦‚ï¼š39.9042,116.4074): 39.9042,116.4074
æŸ¥è¯¢ç»“æœï¼š
  åæ ‡: (39.9042, 116.4074)
  æ‰€å±åŸå¸‚: åŒ—äº¬å¸‚ - åŒ—äº¬å¸‚ - ä¸œåŸåŒº
  åŸå¸‚ä¸­å¿ƒç‚¹: (39.9042, 116.4074)
```

### å‘½ä»¤è¡Œæ¨¡å¼ç¤ºä¾‹

```bash
PS> dotnet run sample-cities.csv 39.9042 116.4074
=== åœ°ç†ä½ç½®åŸå¸‚æ£€æµ‹å™¨ ===

åŠ è½½æ•°æ®æ–‡ä»¶: sample-cities.csv
æˆåŠŸåŠ è½½ 22 ä¸ªåŸå¸‚æ•°æ®
æŸ¥è¯¢åæ ‡: (39.9042, 116.4074)
ç»“æœ: åŒ—äº¬å¸‚ - åŒ—äº¬å¸‚ - ä¸œåŸåŒº
```

## æ‰©å±•åŠŸèƒ½

### æ·»åŠ è¾¹ç•Œæ•°æ®æ”¯æŒ
å¯ä»¥åœ¨åŸå¸‚æ•°æ®ä¸­æ·»åŠ è¾¹ç•Œåæ ‡ç‚¹ï¼Œå®ç°æ›´ç²¾ç¡®çš„åŸå¸‚è¾¹ç•Œåˆ¤æ–­ï¼š

```json
{
  "Province": "åŒ—äº¬å¸‚",
  "City": "åŒ—äº¬å¸‚",
  "District": "ä¸œåŸåŒº",
  "CenterPoint": {
    "Latitude": 39.9042,
    "Longitude": 116.4074
  },
  "Boundary": [
    {"Latitude": 39.9100, "Longitude": 116.4000},
    {"Latitude": 39.9100, "Longitude": 116.4100},
    {"Latitude": 39.9000, "Longitude": 116.4100},
    {"Latitude": 39.9000, "Longitude": 116.4000}
  ]
}
```

## æŠ€æœ¯æ ˆ

- .NET 8.0
- C# 12
- System.Text.Json (JSONå¤„ç†)

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼
